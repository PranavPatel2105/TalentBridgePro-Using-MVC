<style>
    .forgot-header {
        background: linear-gradient(135deg, #0d47a1, #1565c0);
        color: #fff;
        border-radius: 14px;
        padding: 22px 26px;
        margin-bottom: 24px;
        display: flex;
        align-items: center;
        gap: 14px;
    }

    .forgot-header .icon {
        width: 42px;
        height: 42px;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.2);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 20px;
    }

    .card-box {
        background: #fff;
        border-radius: 14px;
        padding: 26px;
        box-shadow: 0 8px 22px rgba(0, 0, 0, 0.06);
    }

    .form-control {
        border-radius: 10px;
        background: #f9fbfd;
    }

    .btn-forgot {
        background: #1e88e5;
        border: none;
        border-radius: 10px;
        padding: 10px;
        width: 100%;
        font-weight: 500;
    }

    .forgot-footer {
        text-align: center;
        margin-top: 16px;
    }

    .modal-content {
        border-radius: 14px;
        box-shadow: 0 8px 22px rgba(0, 0, 0, 0.1);
    }

    .modal-header {
        background: linear-gradient(135deg, #0d47a1, #1565c0);
        color: #fff;
        border-radius: 14px 14px 0 0;
    }

    .modal-body {
        padding: 20px;
    }

    .btn-outline-primary {
        border-radius: 10px;
        font-size: 14px;
    }

    .btn-primary {
        background: #1e88e5;
        border: none;
        font-weight: 500;
        border-radius: 10px;
    }

    .text-primary {
        color: #1e88e5;
    }

    .text-muted {
        font-size: 12px;
    }

    .otp-error {
        display: none;
        color: red;
        font-size: 12px;
    }

    .error-message {
        color: red;
        font-size: 12px;
        display: none;
        margin-top: 5px;
    }
</style>

<div class="container mt-5" style="max-width:460px;">
    <div class="forgot-header">
        <div class="icon">ðŸ”‘</div>
        <div>
            <h5 class="mb-0">Reset Your Password</h5>
            <small>Enter your new password below</small>
        </div>
    </div>

    <div class="card-box">
        <form id="resetPasswordForm" class="k-form">
        </form>
    </div>
</div>

<div id="notification"></div>

@section Scripts {
    <script>
        $(document).ready(function () {
            $("#notification").kendoNotification({
                autoHideAfter: 1000,
                position: {
                    top: 30
                },
                width: 400
            });

            $("#resetPasswordForm").kendoForm({
                items: [
                    {
                        field: "c_newPassword",
                        label: "New Password",
                        editor: function (container, options) {
                            $(`<input type='password' name='${options.field}' id='${options.field}' required data-required-msg="New password is required" placeholder="Enter new password" />`)
                                .appendTo(container).kendoTextBox();
                            $(`<div id="passwordError" class="error-message">Password must be between 8 to 15 characters, including 1 uppercase, 1 lowercase, 1 number, and 1 special character.</div>`).appendTo(container);
                        },
                        validation: {
                            required: { message: "New password is required" }
                        }
                    },
                    {
                        field: "c_confirmPassword",
                        label: "Confirm Password",
                        editor: function (container, options) {
                            $(`<input type='password' name='${options.field}' id='${options.field}' required data-required-msg="Confirm password is required" placeholder="Confirm new password" />`)
                                .appendTo(container).kendoTextBox();
                            $(`<div id="confirmPasswordError" class="error-message">Passwords do not match.</div>`).appendTo(container);
                        },
                        validation: {
                            required: { message: "Confirm password is required" }
                        }
                    }
                ],
                buttonsTemplate: `
                        <div class="mt-3">
                            <button type="button" class="k-button k-primary btn-forgot" style="width:380px" onclick="SaveData()">Reset Password</button>
                        </div>
                    `,
                submit: function (e) {
                    e.preventDefault();
                }
            });

            $('#c_newPassword').on('input', function () {
                const password = $(this).val();
                validatePassword(password);
            });

            $('#c_confirmPassword').on('input', function () {
                const confirmPassword = $(this).val();
                const newPassword = $('#c_newPassword').val();
                validateConfirmPassword(newPassword, confirmPassword);
            });
        });

        function validatePassword(password) {
            const passwordError = $('#passwordError');
            const passwordRegex = /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@@$!%*?&])[A-Za-z\d@@$!%*?&]{8,15}$/;

            if (passwordRegex.test(password)) {
                passwordError.hide();
                $('#c_confirmPassword').prop('disabled', false);
            } else {
                passwordError.show();
                $('#c_confirmPassword').prop('disabled', true);
            }
        }

        function validateConfirmPassword(newPassword, confirmPassword) {
            const confirmPasswordError = $('#confirmPasswordError');

            if (newPassword !== confirmPassword) {
                confirmPasswordError.show();
            } else {
                confirmPasswordError.hide();
            }
        }

        function SaveData() {
            var formData = new FormData($("#resetPasswordForm")[0]);
            var newPassword = formData.get("c_newPassword");
            var confirmPassword = formData.get("c_confirmPassword");

            if (newPassword !== confirmPassword) {
                $("#notification").getKendoNotification().show("Passwords do not match. Please try again.", "error");
                return;
            }

            var email = new URLSearchParams(window.location.search).get('email');

            formData.append("c_email", email)

            console.log(formData)

            $.ajax({
                url: "http://localhost:5140/api/UserApi/ResetPassword",
                type: "POST",
                contentType: false,
                processData: false,
                data: formData,
                success: function (res) {
                    $("#notification").getKendoNotification().show("Password has been reset successfully!", "success");
                    window.location.href = "/User/Login";
                },
                error: function (err) {
                    console.log(err);
                    $("#notification").getKendoNotification().show("Failed to reset password. Please try again.", "error");
                }
            });
        }
    </script>
}
