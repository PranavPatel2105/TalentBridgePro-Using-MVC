@{
    ViewData["Title"] = "Edit Company";
    Layout = "~/Views/Shared/_RecruiterLayout.cshtml";
    var username = @Context.Session.GetString("Name");
    
}



<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Edit Company Profile</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link href="https://kendo.cdn.telerik.com/2024.1.319/styles/kendo.default-v2.min.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

</head>

<body>

    <style>
        body {
            background: #f4f8ff;
        }

        .profile-header {
            background: linear-gradient(90deg, #0d47a1, #1565c0);
            color: #fff;
            border-radius: 14px;
            padding: 22px 26px;
            margin-bottom: 24px;
            display: flex;
            align-items: center;
            gap: 14px;
        }

        .profile-header .icon {
            width: 42px;
            height: 42px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }

        .card-box {
            background: #fff;
            border-radius: 14px;
            padding: 22px;
            margin-bottom: 22px;
            box-shadow: 0 8px 22px rgba(0, 0, 0, 0.06);
        }

        .logo-box {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .logo-box-square {
            width: 110px;
            height: 110px;
            border-radius: 14px;
            border: 2px dashed #cfe2ff;
            background: #f8fbff;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            overflow: hidden;
            flex-shrink: 0;
        }

        .logo-box-square img {
            width: 34px;
            opacity: 0.7;
        }

        .logo-box-square.has-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 12px;
            opacity: 1;
        }

        .logo-text {
            font-size: 12px;
            color: #1e88e5;
            margin-top: 6px;
        }

        .logo-subtext {
            font-size: 11px;
            color: #6c757d;
            margin-top: 4px;
        }

        .upload-hint {
            font-size: 13px;
            color: #6c757d;
        }

        .form-control {
            border-radius: 10px;
            background: #f9fbfd;
        }

        .form-control[readonly] {
            background: #eef1f4;
        }

        .form-label {
            font-weight: 500;
        }

        .btn-update {
            background: #1565c0;
            border: none;
            border-radius: 10px;
            padding: 10px 26px;
        }

        #imageform {
            position: absolute;
            left: -9999px;
            opacity: 0;
            width: 1px;
            height: 1px;
        }

        .placeholder-icon {
            font-size: 25px;
            color: #90caf9;
        }

        .k-upload,
        .k-upload-button,
        .k-upload-files {
            display: none !important;
        }

        /* RESPONSIVE STYLES */
        @@media (max-width: 768px) {
            .container {
                padding-left: 15px;
                padding-right: 15px;
            }

            .profile-header {
                padding: 18px 20px;
                margin-bottom: 20px;
                border-radius: 12px;
            }

            .profile-header .icon {
                width: 36px;
                height: 36px;
                font-size: 18px;
            }

            .profile-header h5 {
                font-size: 1.1rem;
            }

            .profile-header small {
                font-size: 0.85rem;
            }

            .card-box {
                padding: 18px;
                margin-bottom: 18px;
                border-radius: 12px;
            }

            .card-box h6 {
                font-size: 1rem;
            }

            .logo-box {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }

            .logo-box-square {
                width: 100%;
                max-width: 150px;
                height: 150px;
            }

            .btn-update {
                width: 100%;
                padding: 12px 26px;
            }

            .text-end {
                text-align: center !important;
            }
        }

        @@media (max-width: 576px) {
            .profile-header {
                padding: 15px 18px;
                gap: 12px;
            }

            .profile-header .icon {
                width: 32px;
                height: 32px;
                font-size: 16px;
            }

            .profile-header h5 {
                font-size: 1rem;
            }

            .profile-header small {
                font-size: 0.8rem;
            }

            .card-box {
                padding: 15px;
                margin-bottom: 15px;
            }

            .logo-box-square {
                max-width: 120px;
                height: 120px;
            }

            .logo-text {
                font-size: 11px;
            }

            .logo-subtext {
                font-size: 10px;
            }

            .upload-hint {
                font-size: 12px;
            }

            .form-label {
                font-size: 0.9rem;
            }

            .form-control {
                font-size: 0.9rem;
            }
        }

        @@media (max-width: 400px) {
            .container {
                padding-left: 10px;
                padding-right: 10px;
            }

            .profile-header {
                padding: 12px 15px;
            }

            .card-box {
                padding: 12px;
            }

            .btn-update {
                font-size: 0.9rem;
            }
        }
    </style>

    <div class="container mt-4">

        <!-- HEADER -->
        <div class="profile-header">
            <div class="icon">🏢</div>
            <div>
                <h5 class="mb-0">Edit Company Profile</h5>
                <small>Update your company information</small>
            </div>
        </div>

        <form id="companyForm" enctype="multipart/form-data">

            <input type="hidden" id="c_company_id" name="c_company_id" />

            <!-- COMPANY LOGO -->
            <div class="card-box">
                <h6 class="mb-3">Company Logo</h6>

                <div class="logo-box">

                    <div class="logo-box-square" id="logoTrigger">
                        <div>
                            <img src="" id="logoPreview" />
                            <div class="logo-text">Upload Logo</div>
                            <div class="logo-subtext">JPG or PNG only</div>
                        </div>
                    </div>

                    <input type="file" id="imageform" name="imageform" />

                    <div>
                        <p class="mb-1">
                            Upload your company logo. This will be displayed on job listings and your company profile.
                        </p>
                        <small class="upload-hint">
                            Recommended: 400x200 pixels or larger
                        </small><br />
                        <small class="text-danger" id="err_logo"></small>
                    </div>

                </div>
            </div>

            <!-- COMPANY DETAILS -->
            <div class="card-box">
                <h6 class="mb-3">Company Details</h6>

                <div class="row g-3">

                    <div class="col-md-6">
                        <label class="form-label">Company Name *</label>
                        <input type="text" id="c_name" name="c_name" class="form-control"
                            placeholder="Enter company name" />
                        <small class="text-danger" id="err_name"></small>
                    </div>

                    <div class="col-md-6">
                        <label class="form-label">Company Email</label>
                        <input type="text" id="c_company_email" name="c_company_email" class="form-control" readonly />
                    </div>

                </div>
            </div>

            <!-- LOCATION -->
            <div class="card-box">
                <h6 class="mb-3">Location</h6>

                <div class="row g-3">
                    <div class="col-md-6">
                        <label class="form-label">State *</label>
                        <input type="text" id="c_state" name="c_state" class="form-control" placeholder="Enter state" />
                        <small class="text-danger" id="err_state"></small>
                    </div>

                    <div class="col-md-6">
                        <label class="form-label">City *</label>
                        <input type="text" id="c_city" name="c_city" class="form-control" placeholder="Enter city" />
                        <small class="text-danger" id="err_city"></small>
                    </div>
                </div>
            </div>
            <input type="hidden" id="c_userid" name="c_userid" />

            <!-- BUTTON -->
            <div class="text-end">
                <button type="submit" class="btn btn-primary btn-update">
                    Update Company Details
                </button>
            </div>

        </form>
    </div>

    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://kendo.cdn.telerik.com/2024.1.319/js/kendo.all.min.js"></script>

    <script>
        const token = "@Html.Raw(Context.Session.GetString("JWT"))";
        console.log("JWT Token For Edit Recruiter:", token);

        $(document).ready(function () {
        
                /* square click → file popup */
                $("#logoTrigger").on("click", function () {
                    $("#imageform").click();
                });

            /* preview selected image */
            $("#imageform").on("change", function (e) {
                const file = e.target.files[0];
                if (!file) return;

                if (!["image/jpeg", "image/png"].includes(file.type)) return;

                const reader = new FileReader();
                reader.onload = function (ev) {
                    $("#logoPreview").attr("src", ev.target.result);
                    $("#logoTrigger").addClass("has-image");
                    $(".logo-text, .logo-subtext").hide();
                };
                reader.readAsDataURL(file);
            });

            $.ajax({
                url: `http://localhost:5140/api/RecruiterApi/company/me`,
                type: "GET",
                headers: {
                    "Authorization": "Bearer " + token
                },
                success: function (res) {

                    $("#c_company_id").val(res.c_company_id);
                    $("#c_name").val(res.c_name);
                    $("#c_company_email").val(res.c_company_email);
                    $("#c_state").val(res.c_state);
                    $("#c_city").val(res.c_city);
                    $("#c_userid").val(res.c_userid);

                    if (res.c_image) {
                        $("#logoPreview").attr("src", "/company_images/" + res.c_image);
                        $("#logoTrigger").addClass("has-image");
                        $(".logo-text, .logo-subtext").hide();
                    }
                },
                error: function (xhr) {
                    console.error("Failed to load company:", xhr.responseText);

                    Swal.fire({
                        icon: "error",
                        title: "Unauthorized",
                        text: "Failed to load company details"
                    });
                }
            });

//Here added this 
            function clearErrors() {
                $("#err_logo,#err_name,#err_state,#err_city").text("");
            }

            function validateCompanyForm() {
                clearErrors();
                let valid = true;

                if (!$("#c_name").val().trim()) {
                    $("#err_name").text("Company name is required");
                    valid = false;
                }

                if (!$("#c_state").val().trim()) {
                    $("#err_state").text("State is required");
                    valid = false;
                }

                if (!$("#c_city").val().trim()) {
                    $("#err_city").text("City is required");
                    valid = false;
                }

                const logo = $("#imageform")[0].files[0];
                if (logo && !["image/jpeg", "image/png"].includes(logo.type)) {
                    $("#err_logo").text("Only JPG or PNG images allowed");
                    valid = false;
                }

                return valid;
            }


            $("#companyForm").submit(function (e) {
                e.preventDefault();

                if (!validateCompanyForm()) return;

                const formData = new FormData(this);

                $.ajax({
                    url: "http://localhost:5140/api/RecruiterApi/editcompany",
                    type: "PUT",
                    headers: {
                        "Authorization": "Bearer " + token
                    },
                    data: formData,
                    processData: false,
                    contentType: false,
                    success: function () {
                        Swal.fire({
                            icon: "success",
                            title: "Updated Successfully",
                            text: "Your company details have been saved.",
                            confirmButtonColor: "#1e88e5"
                        });
                    },
                    error: function (xhr) {
                        console.error(xhr.responseText);
                        Swal.fire({
                            icon: "error",
                            title: "Update Failed",
                            text: "Something went wrong.",
                            confirmButtonColor: "#d33"
                        });
                    }
                });
            });



        });
    </script>

</body>

</html>